\documentclass[11pt]{article}

\usepackage{latexsym}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{graphicx}
\graphicspath{ {./image/} }
\usepackage{subcaption}
\usepackage{svg}
\usepackage{amsmath}
\usepackage{wrapfig}
\usepackage{pseudocode}
\usepackage{url}
\usepackage[backref, colorlinks=true, citecolor=red, urlcolor=blue, pdfauthor={Jyh-Ming Lien}]{hyperref}


\newcommand{\handout}[5]{
  \noindent
  \begin{center}
  \framebox{
    \vbox{
      \hbox to 5.78in { {\bf } \hfill #2 }
      \vspace{4mm}
      \hbox to 5.78in { {\Large \hfill #5  \hfill} }
      \vspace{2mm}
      \hbox to 5.78in { {\em #3 \hfill #4} }
    }
  }
  \end{center}
  \vspace*{4mm}
}

\newcommand{\lecture}[4]{\handout{#1}{#2}{#3}{#4}{#1}}

\newtheorem{theorem}{Theorem}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{observation}[theorem]{Observation}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{claim}[theorem]{Claim}
\newtheorem{fact}[theorem]{Fact}
\newtheorem{assumption}[theorem]{Assumption}

% 1-inch margins, from fullpage.sty by H.Partl, Version 2, Dec. 15, 1988.
\topmargin 0pt
\advance \topmargin by -\headheight
\advance \topmargin by -\headsep
\textheight 8.9in
\oddsidemargin 0pt
\evensidemargin \oddsidemargin
\marginparwidth 0.5in
\textwidth 6.5in

\parindent 0in
\parskip 1.5ex
%\renewcommand{\baselinestretch}{1.25}

\begin{document}

\lecture{Midterm Exam Report}{Fall 2019}{Hsin-Ping, Hsu}{CS 633 Computational Geometry}

\section{Summary of the hedcut method}
The implementation is based on \cite{wcvt} to generate stipple drawings from grayscale images. The input image is converted to grayscale image that has density function based on the pixels; the darker the pixel is, the higher density it has.The centroidal voronoi diagram can be generated by Lloyd’s method with several iterations by minimizing $\int_{}^{} p(x)*|C_i-x | ^2$.  Following sections describe the summary of Secord's approach. 

\subsection{Initialize random stipples}
Use rejection sampling to generate the initial distribution by selecting a point randomly (uniform distribution) from the input image, and compare the gray value of the selected point with a threshold, the threshold is set by normal distribution with mean 0.8. The point become an initial site if its density is smaller than the threshold, which means that the point is darker and has higher probability to be chosen as a stipple. 

\subsection{Compute Voronoi Diagram}
Calculate the distance (density)of each site, and stores the sites information (distance and pixel) in a max-heap. Compute the voronoi diagram by checking the distances of neighbors of each site, $[Pn_1, Pn_2,...Pn_8]$. Update the distance of $Pn_j$, if the distance of $Pn_j$ is larger than the distance between the site and the neighbor, and then update the site information (rootid) to $Pn_j$. 
Collect the cells by the information that is stored for each point, points that have the same rootid belongs to the same cell.  If the cell only cover the site itself, remove the cell.

\subsection{Compute Centroidal Voronoi tessellation }
The centroidal voronoi diagram can be generated by Lloyd’s method.  In each iteration, a voronoi diagram is generated, then the sites are moved to the centroids of each cell; the centroid could be computed via the definition: $\frac{\int_{A}^{} xp(x)dA} {\int_{A}^{} p(x)dA}$. In addition, the distances moved by the sites are recorded, which will be used to determine the termination of the iterations.
One of convergence criteria of Loyd’s method is the maximum distance moved by the sites are less than a specific value $(max_site_displacement)$. In this project, the number of iteration n can also be set manually. 
A stipple drawing can be created by the weighted centroidal Voronoi diagram, in which each site represents a stipple. 


\section{Improvement of hedcuter method}
\subsection{Improvement 1: Improve the distribution of the disks with subpixel}
Generate a higher resolution image by using subpixel with the technique of bilinear interpolation []. I used the \href{https://docs.opencv.org/2.4/modules/imgproc/doc/geometric_transformations.html}{Geometric Image Transformation} library from OpenCV to obtain an image with higher resolution. Then compute the centroidal Voronoi diagram with the subpixels. Figure. 1 shows the result of this improvement. After resizing the original input image,some details become more clearer. 
\begin{figure}[h!]
	\centering
	\begin{subfigure}[b]{0.8\linewidth}
		\includegraphics[width=\linewidth]{harry3.jpg}
		\caption{Original input image.}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{harry3-10000_random.png}
		\caption{Stippling without using subpixel, number of stipples = 10000}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{harry3-10000_random_sub.png}
		\caption{Stippling by using subpixel, number of stipples = 10000l}
	\end{subfigure}
\caption{Result of using subpixels}
\label{fig:subpixel}
\end{figure}


\subsection{Improvement2: Extract features of input image}
I used the \href{https://docs.opencv.org/trunk/da/d22/tutorial_py_canny.html}{Canny Edge Detection} library from OpenCV to detect the edge of an image, and instead of sampling the initial sites randomly, some initial sites could be placed on the edge to get a better result with a much clearer contour of the image. We can see that the contour of Figure. 2(c) is much clearer than Figure. 2(b), especially the details of the scarves and the owl.

\begin{figure}[h!]
	\centering
	\begin{subfigure}[b]{0.8\linewidth}
		\includegraphics[width=\linewidth]{harry2.jpg}
		\caption{Original input image.}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{harry2_random.png}
		\caption{Stippling with random intial points, number of stipples = 10000}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{harry2_edge.png}
		\caption{Stippling by Canny Edge Detector, number of stipples = 10000l}
	\end{subfigure}
	\caption{Result of using Canny Edge Detector}
	\label{fig:2}
\end{figure}

\subsection{Improvement 3: Generate colorful disks}
I generated the colorful disks with the average color of the points that belong to the same Voronoi regions (cells). In addition, the colorful output image can also be improved by using the higher resolution image and Canny edge detection. Figure.3 shows the result of the colorful disks with improvement 1 and 2.

\begin{figure}[h!]
	\centering
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{harry1.jpg}
		\caption{Original input image.}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{harry2.jpg}
		\caption{Original input image.}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{harry1_color.png}
		\caption{Colorful disks, number of stipples = 10000}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{harry2_color.png}
		\caption{Colorful disks, number of stipples = 10000l}
	\end{subfigure}
	\caption{Result of colorful disks}
	\label{fig:3}
\end{figure}

\subsection{Improvement 4: Adjust the radi of the disks by considering the contrast of the image}
I adjust the radius of each disk by considering the gray value of each point from the input grayscale image. The radius is the proportion to the gray value, which means that a white site has a smaller radius, and a black site has a bigger radius. From Figure. 4, we can see that some misplaced points become relatively small, so that the output image becomes much clearer.  
\begin{figure}[h!]
	\centering
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{harry1.jpg}
		\caption{Original input image.}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{harry1_random.png}
		\caption{Stipples without any improvement, number of stipples = 10000}
	\end{subfigure}
	\begin{subfigure}[b]{0.4\linewidth}
		\includegraphics[width=\linewidth]{harry1_contrast.png}
		\caption{Stipples with different size of disks, number of stipples = 10000l}
	\end{subfigure}
	\caption{Result of adjusting size of disks}
	\label{fig:4}
\end{figure}

\section{Conclusion}
The efficiency of this algorithm have not been improved in this project, there are several ways to improve efficiency. One is to compute the Voronoi diagram by using GPU \cite{fastVor}, and the other is using the L-BFGS method to improve the efficiency of large number of sites in CVT computation \cite{lbfgs}
\bibliographystyle{plain}
\bibliography{report}

\end{document}


